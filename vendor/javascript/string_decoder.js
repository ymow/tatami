import e from"buffer";var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var r={};var h=e.Buffer;var i=h.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(e){if(e&&!i(e))throw new Error("Unknown encoding: "+e)}var c=r.StringDecoder=function(e){(this||t).encoding=(e||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(e);switch((this||t).encoding){case"utf8":(this||t).surrogateSize=3;break;case"ucs2":case"utf16le":(this||t).surrogateSize=2;(this||t).detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":(this||t).surrogateSize=3;(this||t).detectIncompleteChar=base64DetectIncompleteChar;break;default:(this||t).write=passThroughWrite;return}(this||t).charBuffer=new h(6);(this||t).charReceived=0;(this||t).charLength=0};c.prototype.write=function(e){var r="";while((this||t).charLength){var h=e.length>=(this||t).charLength-(this||t).charReceived?(this||t).charLength-(this||t).charReceived:e.length;e.copy((this||t).charBuffer,(this||t).charReceived,0,h);(this||t).charReceived+=h;if((this||t).charReceived<(this||t).charLength)return"";e=e.slice(h,e.length);r=(this||t).charBuffer.slice(0,(this||t).charLength).toString((this||t).encoding);var i=r.charCodeAt(r.length-1);if(!(i>=55296&&i<=56319)){(this||t).charReceived=(this||t).charLength=0;if(0===e.length)return r;break}(this||t).charLength+=(this||t).surrogateSize;r=""}this.detectIncompleteChar(e);var c=e.length;if((this||t).charLength){e.copy((this||t).charBuffer,0,e.length-(this||t).charReceived,c);c-=(this||t).charReceived}r+=e.toString((this||t).encoding,0,c);var c=r.length-1;var i=r.charCodeAt(c);if(i>=55296&&i<=56319){var a=(this||t).surrogateSize;(this||t).charLength+=a;(this||t).charReceived+=a;(this||t).charBuffer.copy((this||t).charBuffer,a,0,a);e.copy((this||t).charBuffer,0,0,a);return r.substring(0,c)}return r};c.prototype.detectIncompleteChar=function(e){var r=e.length>=3?3:e.length;for(;r>0;r--){var h=e[e.length-r];if(1==r&&h>>5==6){(this||t).charLength=2;break}if(r<=2&&h>>4==14){(this||t).charLength=3;break}if(r<=3&&h>>3==30){(this||t).charLength=4;break}}(this||t).charReceived=r};c.prototype.end=function(e){var r="";e&&e.length&&(r=this.write(e));if((this||t).charReceived){var h=(this||t).charReceived;var i=(this||t).charBuffer;var c=(this||t).encoding;r+=i.slice(0,h).toString(c)}return r};function passThroughWrite(e){return e.toString((this||t).encoding)}function utf16DetectIncompleteChar(e){(this||t).charReceived=e.length%2;(this||t).charLength=(this||t).charReceived?2:0}function base64DetectIncompleteChar(e){(this||t).charReceived=e.length%3;(this||t).charLength=(this||t).charReceived?3:0}const a=r.StringDecoder;export default r;export{a as StringDecoder};

